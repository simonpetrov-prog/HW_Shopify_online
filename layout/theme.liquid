<!doctype html>
<html lang="de">

<head>
  <meta charset="utf-8">
  <!-- Viewport: kein Zoom, volle Breite, iOS Safe Areas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

  <title>{{ page_title }} ‚Äì {{ settings.shop_name | default: shop.name }}</title>

  {{ content_for_header }}
  {{ settings.type_body_font | font_face: font_display: 'swap' }}
{{ settings.type_header_font | font_face: font_display: 'swap' }}
  {{ 'base.css' | asset_url | stylesheet_tag }}

  <!-- Basis-Variablen + Grundstyles (konsolidiert) -->
  <style id="hw-vars">


/* Mobile Header Fixes */
@media (max-width: 768px){
  .header__heading .header__heading-link{ font-size:0; line-height:0; }
}
  /* Logo-Bild kompakt halten */
  .header__heading .header__heading-link img{
    max-height:32px !important; height:auto; width:auto; display:inline-block;
  }

  /* Men√ºzeile darf seitlich scrollen statt umbrechen/√ºberlappen */
  nav.header__inline-menu, .header__inline-menu .list-menu{
    overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-width:none;
  }
  nav.header__inline-menu::-webkit-scrollbar, .header__inline-menu .list-menu::-webkit-scrollbar{ display:none; }

/* aktive Nav-Leiste zentriert */
.header .header__nav a.nav__link{
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding-bottom: 6px;
}

.header .header__nav a.nav__link.is-active::after{
  content: "";
  position: absolute;
  bottom: -8px;
  left: 50% !important;
  transform: translateX(-50%) !important;
  width: 24px;               /* L√§nge des Strichs */
  height: 3px;
  border-radius: 2px;
  background: var(--accent, #FF6B00);
}

  /* Falls Textlinks zu breit werden: leicht kleinere Schrift */
  .list-menu__item{ font-size:14px; }
}

/* Warenkorb-Badge sicher positionieren (falls nicht schon vorhanden) */
a[href*="/cart"]{ position:relative; display:inline-flex; align-items:center; gap:6px; }
.header__cart-count{
  position:absolute; right:-8px; top:-6px;
  background:#FF6B00; color:#fff; border-radius:999px;
  padding:2px 6px; font-size:12px; line-height:1; font-weight:800;
}

.hw-bc{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:8px 12px;margin:6px 0 10px;border:1px solid #eee;border-radius:10px;background:#fafafa}
.hw-bc__link{color:#0046BE;text-decoration:none;font-weight:700}
.hw-bc__link:hover{color:#FF6B00}
.hw-bc__sep{opacity:.6}
.hw-bc__current{font-weight:800;color:#1f2937}

  :root{
    --font-body: {{ settings.type_body_font.family | default: 'system-ui' }}, {{ settings.type_body_font.fallback_families | default: 'sans-serif' }};
    --font-heading: {{ settings.type_header_font.family | default: 'system-ui' }}, {{ settings.type_header_font.fallback_families | default: 'sans-serif' }};
    --primary:#0046BE;   /* K√∂nigsblau */
    --accent:#FF6B00;    /* Orange */
    --text:#111;
    --border:#e5e5e5;
    --bg:#fff;
  }

 html,body{background:var(--bg); color:var(--text); font-family:var(--font-body); }
  h1,h2,h3,h4,.h1,.h2,.h3,.h4{ font-family:var(--font-heading); }
a{color:var(--primary); text-decoration:none;}
  a:hover{color:var(--accent);}

  .container{max-width:1200px;margin:0 auto;padding:0 20px;}
  .product-grid.loading { opacity:.3; transition:.2s; pointer-events:none; }

  /* Buttons */
  .btn,button.btn{
    background:var(--primary); color:#fff; border:0; border-radius:10px;
    padding:10px 16px; font-weight:800; letter-spacing:.2px; cursor:pointer;
    transition:transform .06s ease, filter .12s ease, box-shadow .12s ease;
    box-shadow:0 3px 0 rgba(0,0,0,.12);
  }
  .btn:hover{ filter:brightness(.96); transform:translateY(-1px); }
  .btn:active{ transform:translateY(0); box-shadow:none; }
  .btn--primary{ background:var(--accent); }
  .btn--primary:hover{ filter:brightness(.94); }
  .btn-outline{
    background:transparent; color:var(--primary); border:2px solid var(--primary);
    border-radius:10px; padding:8px 14px; font-weight:800;
  }
  .btn-outline:hover{ background:var(--primary); color:#fff; }

  /* Header / Navigation (polish) */
  .header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--border);z-index:30;transition:box-shadow .2s ease;}
  .header.is-scrolled{box-shadow:0 6px 22px rgba(0,0,0,.06);}
  .header__inner{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px 20px;}
  .header__nav{display:flex;gap:12px}
  .nav__link{padding:8px 12px;border-radius:999px;font-weight:800;color:#111}
  .nav__link:hover{background:rgba(0,70,190,.08);color:var(--primary)}
  .nav__link.is-active{background:var(--primary);color:#fff;position:relative}
  .nav__link.is-active::after{
    content:'';
    position:absolute;left:50%;transform:translateX(-50%);
    bottom:-8px;height:3px;width:24px;border-radius:2px;background:var(--accent);
  }

  /* Cart Button */
  .cart-btn{display:flex;align-items:center;gap:10px;background:var(--primary);color:#fff;border:0;border-radius:12px;padding:9px 14px;font-weight:800;cursor:pointer}
  .cart-btn:hover{filter:brightness(.96)}
  .cart-badge{min-width:22px;height:22px;border-radius:999px;display:inline-flex;align-items:center;justify-content:center;background:#000;color:#fff;font-size:12px;padding:0 6px}

  /* Cards / Grid */
  .product-card,.product{border:1px solid var(--border);border-radius:12px;background:#fff;transition:transform .12s ease,box-shadow .12s ease}
  .product-card:hover,.product:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,.06)}
  .product img{background:#fff;border-radius:8px}

  /* Deal Badge */
  .deal-badge{position:absolute;left:10px;top:10px;background:var(--accent);color:#fff;font-weight:800;padding:4px 8px;border-radius:999px;font-size:12px}

  /* Hero Feinheiten */
  .hero-banner__overlay{background:#000}
  .hero-banner__content h1{color:#fff}
  .hero-banner .sub{color:#fff;opacity:.92}
  @media (max-width: 900px){ .hero-banner{ height:56vh; } }
  @media (max-width: 640px){
    .hero-banner{ height:52vh; }
    .hero-banner__overlay{opacity:.55}
  }

  /* Mobile Header Helper (Logo + Quick Buttons) */
  @media (max-width: 768px){
    .header__heading .header__heading-link { font-size:0; line-height:0; }
    .header__heading .header__heading-link img { height:32px !important; width:auto; display:inline-block; }

    .hw-only-mobile { display:inline-flex !important; }
    .hw-quick{
      display:inline-flex; gap:8px; margin-left:8px; vertical-align:middle;
      flex:0 0 auto; white-space:nowrap;
    }
    .hw-qbtn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:6px 10px; border-radius:999px; background:#eee; color:#1f2937;
      border:1px solid #ddd; font-weight:800; text-decoration:none; flex:0 0 auto; white-space:nowrap;
    }
    .hw-qbtn:active { transform: translateY(1px); }
    .header__inline-menu { flex:0 1 auto; }
    .header__icons { margin-left:auto; gap:8px; }
    nav.header__inline-menu, .header__inline-menu .list-menu {
      overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-width:none;
    }
    nav.header__inline-menu::-webkit-scrollbar, .header__inline-menu .list-menu::-webkit-scrollbar { display:none; }
  }
  @media (min-width: 769px){
    .hw-only-mobile { display:none !important; }
  }

  /* Filter-Chips (grau) */
  .hw-chip{
    display:inline-flex;align-items:center;gap:8px;
    background:#eee;color:#333;border:1px solid #ddd;border-radius:999px;
    padding:6px 10px;margin:4px 6px 0 0;font-weight:600;cursor:pointer;user-select:none;
  }
  .hw-chip input{ display:none; }
  .hw-chip .dot{ width:14px;height:14px;border-radius:50%;border:1px solid rgba(0,0,0,.2);display:inline-block; }
  .hw-chip.is-checked{background:#e0e0e0;border-color:#cfcfcf;}
 
.hw-filter-row{
  width:100%;
  background:#ECECEC;
  border:1px solid #ddd;
  border-radius:14px;
  padding:10px 14px;
  margin-bottom:10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-weight:700;
  cursor:pointer;
}
.hw-filter-arrow{ font-size:12px; opacity:.6; }

.hw-filter-body{ display:none; margin-bottom:12px; }
.hw-filter-body.is-open{ display:block; }

.hw-price-grid{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:10px;
}
.hw-price-grid label{
  display:block;
  font-weight:600;
  margin-bottom:4px;
}
.hw-price-grid input{
  width:100%;
  border:1px solid #d5d5d5;
  border-radius:10px;
  padding:6px 10px;
  font-size:14px;
  background:#fff;
}

/* HW Filter Box */
.hw-filter-shell{
  border:3px solid #0046BE;
  border-radius:18px;
  padding:14px 14px 18px;
  background:#fff;
  margin-bottom:20px;
}
.hw-filter-head{
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:center;
  margin-bottom:12px;
}
.hw-filter-head h2{
  font-size:22px;
  font-weight:800;
  color:#0046BE;
  margin:0;
}

.hw-active-filters{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}
.hw-active-pill{
  background:#ECECEC;
  border-radius:999px;
  padding:4px 10px;
  font-weight:600;
  display:flex;
  gap:6px;
  align-items:center;
}
.hw-active-pill button{
  background:transparent;
  border:0;
  font-weight:700;
  cursor:pointer;
}

.hw-filter-tabs{
  display:flex;
  gap:8px;
  margin-bottom:14px;
  flex-wrap:wrap;
}
.hw-tab{
  background:#fff;
  border:1px solid #d9d9d9;
  border-radius:12px;
  padding:6px 14px;
  font-weight:700;
  cursor:pointer;
}
.hw-tab.is-active{
  background:#0046BE;
  color:#fff;
  border-color:#0046BE;
}
.hw-tab.hw-tab--reset{
  margin-left:auto;
  background:#eee;
  border-color:#eee;
  color:#111;
}

.hw-panels{ width:100%; }
.hw-panel{ display:none; }
.hw-panel.is-open{ display:block; }

.hw-price-grid{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:12px;
  margin-bottom:14px;
}
.hw-price-grid label{
  display:block;
  font-weight:600;
  margin-bottom:4px;
}
.hw-price-grid input{
  width:100%;
  border:1px solid #d5d5d5;
  border-radius:10px;
  padding:6px 10px;
  font-size:14px;
  background:#fff;
}

.hw-chip-wrap{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:14px;
}
.hw-chip-wrap--column{
  flex-direction:column;
  align-items:flex-start;
}
.hw-chip{
  display:inline-flex;
  gap:8px;
  align-items:center;
  background:#F2F2F2;
  border:1px solid #E0E0E0;
  border-radius:999px;
  padding:6px 12px;
  cursor:pointer;
  font-weight:600;
}
.hw-chip input{ display:none; }
.hw-chip .dot{
  width:14px; height:14px; border-radius:50%; background:#ddd;
}
.hw-chip.is-selected{
  background:#0046BE;
  color:#fff;
  border-color:#0046BE;
}
.hw-chip.is-selected .dot{
  background:#fff;
}

.hw-apply{
  background:#FF6B00;
  color:#fff;
  border:0;
  border-radius:10px;
  padding:8px 14px;
  font-weight:700;
  cursor:pointer;
}

@media (max-width: 720px){
  .hw-price-grid{ grid-template-columns:1fr; }
  .hw-filter-head{ flex-direction:column; align-items:flex-start; }
  .hw-filter-tabs{ gap:6px; }
}


</style>

<style id="hw-filter-css-fix">
  /* Panels standardm√§√üig zu */
  .filter-panel{ display:none; }

  /* ge√∂ffnet per Klasse */
  .filter-panel.is-open{ display:block; }

  /* Sicherheit: Buttons bleiben klickbar */
  .filter-toggle{ pointer-events:auto; }

  /* Falls irgendwo noch ein Overlay st√∂rt: nur aktiv bei offenem Panel */
  .hw-filter-overlay[hidden]{ display:none !important; }
  .hw-filter-overlay{ pointer-events:none; }
  .filters-container.is-open .hw-filter-overlay{ pointer-events:auto; }

/* PDP Tabs */
.pdp-tabs{display:flex;gap:8px;margin:16px 0}
.pdp-tab{padding:8px 12px;border:1px solid #ddd;border-radius:10px;background:#f6f7fb;color:#111;font-weight:800;cursor:pointer}
.pdp-tab.is-active{background:var(--primary);color:#fff;border-color:var(--primary)}
.pdp-panel{display:none;border:1px solid #eee;border-radius:12px;padding:14px;background:#fff}
.pdp-panel.is-active{display:block}

/* PDP Tabs ‚Äì kompakt, klar, kontrastreich */
.pdp-tabs{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:14px 0 8px}
.pdp-tab{
  appearance:none;
  border:1px solid #e5e7eb;
  background:#f6f7fb;
  color:#111;
  padding:10px 14px;
  border-radius:12px;
  font-weight:800;
  line-height:1;
  cursor:pointer;
  transition:.15s ease;
}
.pdp-tab:hover{border-color:var(--primary,#0046BE)}
.pdp-tab.is-active{
  background:var(--primary,#0046BE);
  border-color:var(--primary,#0046BE);
  color:#fff;
  box-shadow:0 6px 18px rgba(0,70,190,.16);
}

.pdp-panels{margin-top:10px}
.pdp-panel{
  display:none;
  border:1px solid #eee;
  border-radius:12px;
  padding:14px;
  background:#fff;
}
.pdp-panel.is-active{display:block}

/* Mobile etwas kleiner */
@media (max-width:640px){
  .pdp-tab{padding:8px 12px;font-size:14px}
}

/* HW Cart Badge */
.header__icon{ position:relative; display:inline-flex; align-items:center; gap:6px; }
.header__cart-count{
  position:absolute; right:-8px; top:-6px;
  background:#FF6B00; color:#fff; border-radius:999px;
  padding:2px 6px; font-size:12px; line-height:1; font-weight:900;
}
@media (max-width:768px){ .header__icons .label{ display:none; } }

/* Sticky ATC */
.hw-sticky-atc{
  position:fixed; left:0; right:0; bottom:0;
  background:#fff; border-top:1px solid #e5e5e5;
  z-index:70; box-shadow:0 -10px 25px rgba(0,0,0,.04);
  padding:6px 10px;
}
.hw-sticky-atc[hidden]{ display:none !important; }
.hw-sticky-atc__inner{
  max-width:1200px; margin:0 auto;
  display:flex; align-items:center; gap:10px;
}
.hw-sticky-atc img{
  width:46px; height:46px; object-fit:cover; border-radius:8px;
}
.hw-sticky-atc__info .title{ font-weight:800; margin:0; }
.hw-sticky-atc__info .price{ margin:2px 0 0; }
.hw-sticky-atc__info .price .old{ text-decoration:line-through; opacity:.55; margin-right:4px; }
.hw-sticky-atc__form .btn{ border-radius:999px; }
@media (max-width:640px){
  .hw-sticky-atc__inner{ gap:8px; }
  .hw-sticky-atc__info .title{ font-size:13px; }
  .hw-sticky-atc__form .btn{ padding:8px 14px; }
}

</style>

<style id="hw-grid-loading">
  .product-grid.loading { opacity:.35; pointer-events:none; transition:opacity .2s; }
</style>

  <!-- Header Shadow on scroll (einmalig) -->
  <script>
  document.addEventListener('scroll', function(){
    var h=document.querySelector('.header');
    if(!h) return;
    h.classList.toggle('is-scrolled', window.scrollY>8);
  });
  </script>

  <!-- Farb-Checkboxen -> Chips (robust, ohne Arrow-Functions) -->
  <script id="hw-color-chips">
  (function () {
    try {
      function norm(s){
        if(!s) return '';
        try {
          return s.toString().trim().toLowerCase()
            .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
            .replace(/√ü/g,'ss');
        } catch(e){
          return s.toString().trim().toLowerCase()
            .replace(/√§/g,'ae').replace(/√∂/g,'oe').replace(/√º/g,'ue').replace(/√ü/g,'ss');
        }
      }
      var COLOR_MAP = {
        'tuerkis':'#1abc9c','blau':'#1e3a8a','rot':'#e11d48','orange':'#f97316',
        'schwarz':'#111827','weiss':'#ffffff','grau':'#9ca3af','gelb':'#f59e0b',
        'grun':'#16a34a','lila':'#7c3aed','pink':'#db2777'
      };
      var panels = document.querySelectorAll('#filter-color, [data-panel="color"]');
      if (!panels || !panels.length) return;
      for (var p = 0; p < panels.length; p++) {
        var panel = panels[p];
        var labels = panel.querySelectorAll('label');
        for (var i = 0; i < labels.length; i++) {
          var label = labels[i];
          if (label.classList && label.classList.contains('hw-chip')) continue;
          var input = label.querySelector('input[type="checkbox"]');
          if (!input) continue;
          var rawName = (input.value || label.textContent || '').trim();
          var key = norm(rawName).replace(/√§/g,'ae').replace(/√∂/g,'oe').replace(/√º/g,'ue');
          var dotColor = COLOR_MAP[key] || '#ddd';

          var dot = document.createElement('span');
          dot.className = 'dot';
          dot.style.width = '14px';
          dot.style.height = '14px';
          dot.style.borderRadius = '50%';
          dot.style.border = '1px solid rgba(0,0,0,.2)';
          dot.style.display = 'inline-block';
          dot.style.background = dotColor;

          // alte Knoten au√üer input entfernen
          var keep = [input]; var toRemove = [];
          for (var n = 0; n < label.childNodes.length; n++) {
            var node = label.childNodes[n];
            if (keep.indexOf(node) === -1) toRemove.push(node);
          }
          for (var r = 0; r < toRemove.length; r++) {
            if (toRemove[r] && toRemove[r].parentNode === label) label.removeChild(toRemove[r]);
          }
          if (label.classList) label.classList.add('hw-chip');
          label.appendChild(input);
          label.appendChild(dot);
          label.appendChild(document.createTextNode(' ' + rawName));

          var sync = (function(inp, lab){
            return function(){
              if (!lab || !lab.classList) return;
              if (inp.checked) lab.classList.add('is-checked');
              else lab.classList.remove('is-checked');
            };
          })(input, label);
          input.addEventListener('change', sync);
          sync();
        }
      }
    } catch (err) {
      if (console && console.warn) console.warn('HW color chips init failed:', err);
    }
  })();

  </script>

  <!-- Zoom-Blocker / iOS Gesten -->
  <style>
    html, body { overflow-x: hidden; }
    html { -webkit-text-size-adjust: 100%; }
    html, body { touch-action: manipulation; }
  </style>
  <script>
    ['gesturestart','gesturechange','gestureend'].forEach(function(ev){
      document.addEventListener(ev, function(e){ e.preventDefault(); }, { passive:false });
    });
    (function(){
      var lastTouchEnd = 0;
      document.addEventListener('touchend', function(e) {
        var now = Date.now();
        if (now - lastTouchEnd <= 300) { e.preventDefault(); }
        lastTouchEnd = now;
      }, { passive:false });
    })();
  </script>

<script>
/* Auto-Fix: doppelte Header auf Produktseiten entfernen (nur dort) */
document.addEventListener('DOMContentLoaded', function () {
  if (!/\btemplate-product\b/.test(document.body.className)) return;

  // Sammle alle m√∂glichen Header-Elemente, die Themes nutzen
  var headers = document.querySelectorAll('header, .site-header, header[role="banner"], .header');

  if (headers.length > 1) {
    // Ersten behalten, alle weiteren entfernen
    for (var i = 1; i < headers.length; i++) {
      if (headers[i] && headers[i].parentNode) {
        headers[i].parentNode.removeChild(headers[i]);
      }
    }
  }
});
</script>

<script id="hw-filter-toggle-fix">
document.addEventListener('DOMContentLoaded', function(){
  // Ein globaler Click-Listener reicht √ºberall (Snippet/Section egal)
  document.addEventListener('click', function(e){
    var btn = e.target.closest('.filter-toggle');
    if(!btn) return;

    // Zielpanel ID nach Schema: #filter-{data-target}
    var target = btn.getAttribute('data-target');
    if(!target) return;

    var panel = document.getElementById('filter-' + target);
    if(!panel) return;

    e.preventDefault();
    panel.classList.toggle('is-open');
  }, true);
});

#toast-root{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;z-index:9999}
.hw-toast{
  background:#111;color:#fff;padding:10px 14px;border-radius:10px;
  box-shadow:0 8px 20px rgba(0,0,0,.2);margin-top:8px;font-weight:700;min-width:220px;text-align:center
}
.hw-toast--ok{background:#0f766e}   /* gr√ºnlich */
.hw-toast--info{background:#1f2937} /* dunkelgrau */
.hw-toast--err{background:#b91c1c}  /* rot */

</script>

<script id="hw-ajax-filters">
document.addEventListener('DOMContentLoaded', function(){
  var root = document.querySelector('[data-hw-filters]') || document;
  var applyBtn = root.querySelector('[data-apply]') || document.querySelector('[data-apply]');
  var form = root.querySelector('#filters-form') || document.querySelector('#filters-form');

  // Finde das Grid robust (versch. Themes)
  function findGrid(){
    return document.querySelector('#ProductGridContainer') ||
           document.querySelector('[data-section-id="product-grid"]') ||
           document.querySelector('[data-id="product-grid"]') ||
           document.querySelector('.product-grid');
  }

  // Falls du sp√§ter anders hei√üt, hier erg√§nzen:
  function guessSectionId(fallback){
    var el = document.querySelector('[data-section-id]'); // oft am Grid
    if(el && el.getAttribute('data-section-id')) return el.getAttribute('data-section-id');
    return fallback || 'product-grid'; // g√§ngiger Name
  }

  // URL aus UI bauen (kompatibel zu deiner aktuellen Struktur)
  function toCents(v){
    var n = Math.round(parseFloat((v||'').toString().replace(',','.'))*100);
    return isNaN(n) ? null : n;
  }
  function buildUrlFromUI(){
    var url = new URL(window.location.href);

    // alte filter.* entfernen
    Array.from(url.searchParams.keys()).forEach(function(k){
      if(k.indexOf('filter.') === 0) url.searchParams.delete(k);
    });

    // Preis
    var minI = (root.querySelector('[data-min]') || document.querySelector('[data-min]'));
    var maxI = (root.querySelector('[data-max]') || document.querySelector('[data-max]'));
    var min = minI && minI.value, max = maxI && maxI.value;
    var minC = toCents(min), maxC = toCents(max);
    if(min && minC!==null) url.searchParams.set('filter.p.price.gte', String(minC));
    if(max && maxC!==null) url.searchParams.set('filter.p.price.lte', String(maxC));

    // Tags (Farbe / Marke / Serie)
    function addChecked(sel, prefix){
      (root.querySelectorAll(sel) || []).forEach(function(inp){
        if(inp.checked){ url.searchParams.append('filter.p.tag', prefix+' '+inp.value); }
      });
    }
    addChecked('[data-color]',  'Farbe:');
    addChecked('[data-brand]',  'Marke:');
    addChecked('[data-series]', 'Serie:');

    return url;
  }

  async function fetchGrid(url){
    var grid = findGrid();
    if(!grid) return;

    // Grid dezent ‚Äûladen‚Äú
    grid.classList.add('loading');

    // Section-ID raten / lesen
    var secId = guessSectionId('product-grid');

    // Request: nur die Grid-Section neu laden
    var apiUrl = url.toString();
    apiUrl += (apiUrl.indexOf('?')>-1 ? '&' : '?') + 'section_id=' + encodeURIComponent(secId);

    try{
      var res = await fetch(apiUrl, { credentials:'same-origin' });
      var html = await res.text();
      var doc = new DOMParser().parseFromString(html, 'text/html');

      // neue Grid-HTML extrahieren
      var newGrid = doc.querySelector('#ProductGridContainer') ||
                    doc.querySelector('[data-section-id="product-grid"]') ||
                    doc.querySelector('[data-id="product-grid"]') ||
                    doc.querySelector('.product-grid');
      if(newGrid){
        grid.innerHTML = newGrid.innerHTML;
        grid.classList.remove('loading');
      } else {
        grid.classList.remove('loading');
        console.warn('HW AJAX: Grid selector not found in response');
      }

      // URL in der Leiste aktualisieren (Back/Share funktioniert)
      history.pushState({}, '', url.toString());

      // Event feuern, damit Chips/Counter etc. refreshen k√∂nnen
      document.dispatchEvent(new Event('filters:refresh'));
    }catch(err){
      grid.classList.remove('loading');
      console.warn('HW AJAX error:', err);
    }
  }

  // Klick auf "Filter anwenden" abfangen (oder Form-Submit)
  function startAjax(e){
    if(e){ e.preventDefault(); }
    var url = buildUrlFromUI();
    fetchGrid(url);
  }

  if(applyBtn){ applyBtn.addEventListener('click', startAjax); }
  if(form){ form.addEventListener('submit', startAjax); }
});




</script>

 <script>
window.showToast = function(msg, type='ok', ms=2200){
  const root = document.getElementById('toast-root'); if(!root) return;
  const el = document.createElement('div');
  el.className = 'hw-toast hw-toast--' + (type==='err'?'err':type==='info'?'info':'ok');
  el.textContent = msg;
  root.appendChild(el);
  setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translateY(6px)'; }, ms);
  setTimeout(()=>{ root.removeChild(el); }, ms+400);
};
</script>



</head>


  <body>
    {{ content_for_layout }}

<div id="toast-root" aria-live="polite" aria-atomic="true"></div>

<script>
// F√§ngt alle fetch-Aufrufe ab (nur f√ºr unseren Shop, keine externen)
// und zeigt je nach Endpoint einen Toast an.
(function(){
  if (!window.fetch) return;
  const _fetch = window.fetch;
  window.fetch = async function(input, init){
    const res = await _fetch(input, init);
    try {
      const url = (typeof input === 'string') ? input : input.url;
      if (url && url.indexOf('/cart/add') !== -1) {
        if (res.ok) showToast('‚úÖ Produkt in den Warenkorb gelegt','ok');
        else        showToast('‚ö†Ô∏è Konnte nicht hinzugef√ºgt werden','err');
      }
      if (url && url.indexOf('/cart/change') !== -1) {
        if (res.ok) showToast('Menge aktualisiert','info');
      }
      if (url && url.indexOf('/cart/clear') !== -1) {
        if (res.ok) showToast('üßπ Warenkorb geleert','info');
      }
      if (url && url.indexOf('/cart/update') !== -1) {
        if (res.ok) showToast('Warenkorb aktualisiert','info');
      }
    } catch(e){}
    return res;
  };

  // Bonus: sehr alte Themes nutzen manchmal XHR statt fetch
  if (window.XMLHttpRequest) {
    const _open = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url){
      this.__hw_url = url;
      return _open.apply(this, arguments);
    };
    const _send = XMLHttpRequest.prototype.send;
    XMLHttpRequest.prototype.send = function(){
      this.addEventListener('load', function(){
        try {
          const url = this.__hw_url || '';
          if (url.indexOf('/cart/add') !== -1) {
            (this.status>=200 && this.status<300)
              ? showToast('‚úÖ Produkt in den Warenkorb gelegt','ok')
              : showToast('‚ö†Ô∏è Konnte nicht hinzugef√ºgt werden','err');
          }
          if (url.indexOf('/cart/change') !== -1) {
            (this.status>=200 && this.status<300)
              ? showToast('Menge aktualisiert','info')
              : null;
          }
        } catch(e){}
      });
      return _send.apply(this, arguments);
    };
  }
})();
</script>

<script>
/* Universelle UI-Trigger f√ºr Toasts (funktioniert ohne fetch-Hook) */
(function(){
  if (typeof window.showToast !== 'function') return;

  // 1) Klicks auf Add-to-Cart / Entfernen / Menge
  document.addEventListener('click', function(e){
    const el = e.target.closest('button, a, input');
    if (!el) return;

    const nameAttr = (el.getAttribute('name') || '').toLowerCase();
    const idAttr   = (el.getAttribute('id') || '').toLowerCase();
    const cls      = el.className || '';

    // Add to cart: viele Themes nutzen name="add" oder Klasse add-to-cart
    if (
      nameAttr === 'add' ||
      /(^|\s)add-to-cart(\s|$)/i.test(cls) ||
      el.dataset.addToCart !== undefined
    ) {
      // kleinen Delay, damit UI sich aktualisieren kann
      setTimeout(()=> showToast('‚úÖ Produkt in den Warenkorb gelegt','ok'), 150);
      return;
    }

    // Entfernen aus dem Cart
    if (
      /remove/i.test(nameAttr) ||
      /cart-item__remove|remove-item|cart-remove/i.test(cls) ||
      el.dataset.cartRemove !== undefined
    ) {
      setTimeout(()=> showToast('üóëÔ∏è Aus dem Warenkorb entfernt','info'), 150);
      return;
    }

    // Mengen√§nderung (+ / -)
    if (
      /qty|quantity|menge/i.test(nameAttr) ||
      /qty__button|quantity-button|js-qty/i.test(cls) ||
      el.dataset.qty !== undefined
    ) {
      setTimeout(()=> showToast('Menge aktualisiert','info'), 200);
      return;
    }
  }, true); // useCapture=true, damit wir m√∂glichst fr√ºh dran sind

  // 2) (Optional) Wenn dein Filter-Formular Buttons hat:
  document.addEventListener('click', function(e){
    const b = e.target.closest('button');
    if (!b) return;
    if (/filter.*anwenden/i.test(b.textContent||'')) {
      setTimeout(()=> showToast('Filter angewendet','info'), 100);
    }
    if (/zur√ºcksetzen|reset/i.test(b.textContent||'')) {
      setTimeout(()=> showToast('Alle Filter entfernt','info'), 100);
    }
  }, true);
})();
</script>

<!-- ‚úÖ HW TOAST SYSTEM (ULTRA-STABLE FINAL) -->
<div id="toast-root" aria-live="polite" aria-atomic="true"></div>

<style>
  #toast-root {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: 16px;
    z-index: 9999;
    pointer-events: none;
  }
  .hw-toast {
    background: #111;
    color: #fff;
    padding: 10px 14px;
    border-radius: 10px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, .2);
    margin-top: 8px;
    font-weight: 700;
    min-width: 220px;
    text-align: center;
    transition: opacity .3s, transform .3s;
  }
  .hw-toast--ok  { background: #0f766e; }
  .hw-toast--info{ background: #1f2937; }
  .hw-toast--err { background: #b91c1c; }
</style>

<script>
  // Basisfunktion: Toast anzeigen
  window.showToast = window.showToast || function (msg, type, ms) {
    const root = document.getElementById('toast-root');
    if (!root) return;
    const el = document.createElement('div');
    el.className = 'hw-toast ' + (type === 'err' ? 'hw-toast--err' :
      type === 'info' ? 'hw-toast--info' : 'hw-toast--ok');
    el.textContent = msg;
    root.appendChild(el);
    setTimeout(() => { el.style.opacity = '0'; el.style.transform = 'translateY(6px)'; },
               ms || 2200);
    setTimeout(() => { if (el.parentNode) root.removeChild(el); },
               (ms || 2200) + 400);
  };
</script>

<script>
  (function(){
    let toastLock = false;
    const LOCK_TIME = 2000; // 2s Sperre

    function safeToast(msg, type){
      if(toastLock) return;
      toastLock = true;
      showToast(msg, type);
      setTimeout(()=> toastLock = false, LOCK_TIME);
    }

    function getCountEl(){
      return document.querySelector('.header__cart-count')
          || document.querySelector('.cart-count')
          || document.querySelector('[data-cart-count]');
    }
    function readCount(el){
      if(!el) return 0;
      const t = (el.getAttribute('data-cart-count') || el.textContent || '').trim();
      const n = parseInt(t, 10);
      return isNaN(n)?0:n;
    }

    let countEl = getCountEl();
    let last = readCount(countEl);

    function hookObserver(){
      try {
        const obs = new MutationObserver(() => {
          const cur = readCount(countEl);
          if(cur > last){ safeToast('‚úÖ Produkt in den Warenkorb gelegt', 'ok'); }
          else if(cur < last){ safeToast('üóëÔ∏è Aus dem Warenkorb entfernt', 'info'); }
          last = cur;
        });
        obs.observe(countEl, {
          characterData:true, childList:true, subtree:true,
          attributes:true, attributeFilter:['data-cart-count']
        });
      } catch(e){}
    }

    if(countEl){ hookObserver(); }
    else{
      let tries=0;
      const iv=setInterval(()=>{
        countEl=getCountEl();
        if(countEl){ hookObserver(); clearInterval(iv); }
        else if(++tries>20){ clearInterval(iv); }
      },500);
    }

    document.addEventListener('click', e=>{
      const el = e.target.closest('button,a,input');
      if(!el) return;
      const name=(el.getAttribute('name')||'').toLowerCase();
      const cls=(el.className||'');

      // Mengen√§nderung
      if(/qty|quantity|menge/.test(name)||/qty|quantity|js-qty|plus|minus/.test(cls)){
        setTimeout(()=> safeToast('Menge aktualisiert','info'),150);
      }

      // Add-to-Cart Button (manchmal doppelt bei AJAX -> delay + Sperre)
      if(name==='add' || /add-to-cart|product-form__submit/i.test(cls)){
        setTimeout(()=>{
          const cur=readCount(getCountEl());
          if(cur===last){ safeToast('‚úÖ Produkt in den Warenkorb gelegt','ok'); }
        },700);
      }
    },true);
  })();
</script>

<style>
/* HW Cart Drawer Polish */
.cart-drawer{--cd-gap:12px;}
.cart-drawer .cart-items{display:flex;flex-direction:column;gap:var(--cd-gap)}
.cart-drawer .cart-item{display:grid;grid-template-columns:72px 1fr auto;gap:10px;align-items:center;border:1px solid #e5e5e5;border-radius:12px;padding:8px;background:#fff}
.cart-drawer .cart-item img{width:72px;height:72px;object-fit:cover;border-radius:8px;background:#fff}
.cart-drawer .ci-title{font-weight:800;line-height:1.2;margin:0 0 6px}
.cart-drawer .ci-meta{font-size:12px;opacity:.7;margin:0}

.cart-drawer .ci-actions{display:flex;align-items:center;gap:8px;margin-top:6px}
.cart-drawer .qty-wrap{display:inline-flex;align-items:center;border:1px solid #ddd;border-radius:10px;overflow:hidden}
.cart-drawer .qty-btn{width:34px;height:34px;display:inline-flex;align-items:center;justify-content:center;font-weight:900;background:#f6f7fb;border:0;cursor:pointer}
.cart-drawer .qty-btn:active{transform:translateY(1px)}
.cart-drawer .qty-input{width:44px;height:34px;text-align:center;border:0;border-left:1px solid #ddd;border-right:1px solid #ddd;background:#fff}

.cart-drawer .ci-price{text-align:right;font-weight:800}
.cart-drawer .ci-remove{background:transparent;border:0;color:#666;font-weight:900;font-size:18px;cursor:pointer}
.cart-drawer .ci-remove:hover{color:#000}

.cart-drawer .drawer-footer{margin-top:14px;border-top:1px solid #eee;padding-top:12px}
.cart-drawer .subtotal{display:flex;justify-content:space-between;align-items:center;font-weight:900;margin:0 0 10px}
.cart-drawer .checkout-btn{width:100%;padding:12px 16px;border:0;border-radius:12px;background:var(--accent,#FF6B00);color:#fff;font-weight:900;cursor:pointer}
.cart-drawer .checkout-btn:hover{filter:brightness(.95)}

/* Mobile Tap-Targets etwas gr√∂√üer */
@media (max-width:768px){
  .cart-drawer .qty-btn{width:38px;height:38px}
  .cart-drawer .qty-input{width:50px;height:38px}
}
</style>

<style>
/* HW Mobile Header Polish */
header.header, .site-header{position:sticky;top:0;z-index:40;background:#fff;border-bottom:1px solid #eee}
.header__heading .header__heading-link{font-size:0;line-height:0}
.header__heading .header__heading-link img{height:32px;width:auto;display:inline-block}

.header__icons{margin-left:auto;display:flex;align-items:center;gap:10px}
.header__icon{position:relative;display:inline-flex;align-items:center;gap:6px}
.header__cart-count,.cart-badge{position:absolute;right:-8px;top:-6px;background:#FF6B00;color:#fff;border-radius:999px;padding:2px 6px;font-size:12px;font-weight:900;line-height:1}

/* Men√º Links (Startseite/Produkte) */
.header__inline-menu .list-menu{display:flex;gap:8px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.header__inline-menu .list-menu::-webkit-scrollbar{display:none}
.header__inline-menu a{padding:8px 12px;border-radius:999px;font-weight:800;color:#111}
.header__inline-menu a:hover{background:rgba(0,70,190,.08);color:var(--primary,#0046BE)}
.header__inline-menu a.is-active{background:var(--primary,#0046BE);color:#fff;position:relative}
.header__inline-menu a.is-active::after{content:"";position:absolute;left:0;right:0;margin:auto;bottom:-6px;width:24px;height:3px;border-radius:2px;background:var(--accent,#FF6B00)}

@media (max-width:768px){
  .header__icons .label{display:none}
}

</style>

<!-- HW Search Overlay -->
<div id="hw-search" class="hw-search" hidden>
  <div class="hw-search__backdrop" data-close></div>
  <div class="hw-search__panel">
    <form action="/search" method="get" role="search" class="hw-search__form">
      <input type="search" name="q" placeholder="Suche nach Modellen, Marken‚Ä¶" autocomplete="off" autofocus>
      <button type="submit" class="btn btn--primary">Suchen</button>
    </form>
    <button class="hw-search__close" type="button" data-close>√ó</button>
  </div>
</div>

<style>
.hw-search[hidden]{display:none}
.hw-search{position:fixed;inset:0;z-index:60}
.hw-search__backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45)}
.hw-search__panel{
  position:absolute;left:50%;top:12%;transform:translateX(-50%);
  width:min(720px,92vw);background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.25);
  padding:16px;border:1px solid #e5e5e5
}
.hw-search__form{display:flex;gap:10px}
.hw-search__form input{
  flex:1;border:1px solid #ddd;border-radius:12px;padding:12px 14px;font-size:16px
}
.hw-search__close{
  position:absolute;right:10px;top:10px;background:#eee;border:0;border-radius:10px;width:36px;height:36px;font-size:20px;font-weight:900;cursor:pointer
}
@media (max-width:768px){
  .hw-search__panel{top:6%}
}

/* Badge IM Warenkorb-Button (nicht oben im Header) */
.cart-btn .cart-badge {
  position: static !important;   /* nicht mehr oben rechts */
  margin-left: 2px;
}

/* Badge nur zeigen, wenn sie NICHT hidden ist */
.cart-badge[hidden] {
  display: none !important;
}

</style>

<script>
(function(){
  const root = document.getElementById('hw-search');
  const toggles = document.querySelectorAll('.hw-search-toggle');
  if(!root || !toggles.length) return;

  function open(){
    root.hidden = false;
    const inp = root.querySelector('input[name="q"]');
    setTimeout(()=> inp && inp.focus(), 50);
    document.body.style.overflow = 'hidden';
  }
  function close(){
    root.hidden = true;
    document.body.style.overflow = '';
    toggles.forEach(t=> t.setAttribute('aria-expanded','false'));
  }

  toggles.forEach(t=>{
    t.addEventListener('click', ()=>{
      t.setAttribute('aria-expanded','true');
      open();
    });
  });
  root.addEventListener('click', (e)=>{ if(e.target.closest('[data-close]')) close(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && !root.hidden) close(); });
})();
</script>

<script>
(function(){
  // 1. Alle Buttons, die den Warenkorb √∂ffnen sollen
  const openers = document.querySelectorAll('[data-open-cart], .js-open-cart');

  // 2. Versuchen, einen Drawer zu finden (mehrere m√∂gliche Namen)
  function findCartDrawer(){
    return document.querySelector('.cart-drawer')
        || document.querySelector('[data-cart-drawer]')
        || document.querySelector('.drawer--cart')
        || document.querySelector('#CartDrawer');
  }

  function openDrawer(){
    const drawer = findCartDrawer();
    if (!drawer) return;
    drawer.classList.add('is-open');
    document.body.style.overflow = 'hidden';
  }

  function closeDrawer(){
    const drawer = findCartDrawer();
    if (!drawer) return;
    drawer.classList.remove('is-open');
    document.body.style.overflow = '';
  }

  // 3. Button-Klicks anbinden
  openers.forEach(btn => {
    btn.addEventListener('click', (e)=>{
      e.preventDefault();
      openDrawer();
    });
  });

  // 4. Schlie√üen (X / Close-Button / Overlay)
  document.addEventListener('click', (e)=>{
    if (e.target.matches('[data-cart-close], .cart-drawer__close')) {
      e.preventDefault();
      closeDrawer();
    }
    // Klick auf dunklen Hintergrund
    if (e.target.classList && e.target.classList.contains('cart-drawer')) {
      closeDrawer();
    }
  });

  // 5. ESC schlie√üt auch
  document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape') {
      closeDrawer();
    }
  });
})();
</script>

<script>
(function(){
  const bar = document.getElementById('hw-sticky-atc');
  if (!bar) return;
  // Element, das wir beobachten (dein normales Produkt-Formular)
  const target = document.querySelector('form[action="/cart/add"]');
  if (!target) return;

  function check(){
    const rect = target.getBoundingClientRect();
    const isVisible = rect.top >= 0 && rect.bottom <= window.innerHeight;
    bar.hidden = isVisible; // wenn Original sichtbar -> Sticky aus
  }
  check();
  document.addEventListener('scroll', check, { passive:true });
  window.addEventListener('resize', check);
})();
</script>

<script>
document.addEventListener('submit', function(e){
  const form = e.target;
  if (!form.classList || !form.classList.contains('hw-inline-search')) return;
  e.preventDefault();
  const q = form.querySelector('input[name="q"]')?.value || '';
  // weiterleiten auf deine Produktseite, Suchbegriff mitgeben
  window.location.href = '/collections/all?q=' + encodeURIComponent(q);
});
</script>

<script>
document.addEventListener('click', function(e){
  const row = e.target.closest('[data-acc]');
  if (!row) return;

  const key = row.getAttribute('data-acc');
  const body = document.querySelector('[data-acc-body="'+key+'"]');
  if (!body) return;

  const isOpen = body.classList.contains('is-open');

  // erst alle zu
  document.querySelectorAll('.hw-filter-body').forEach(b => b.classList.remove('is-open'));

  // dann nur den anklickten auf
  if (!isOpen) {
    body.classList.add('is-open');
  }
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function(){

  // Tabs schalten
  const tabs = document.querySelectorAll('.hw-tab[data-filter]');
  const panels = document.querySelectorAll('.hw-panel');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const key = tab.dataset.filter;
      // tabs
      tabs.forEach(t => t.classList.remove('is-active'));
      tab.classList.add('is-active');
      // panels
      panels.forEach(p => {
        p.classList.toggle('is-open', p.dataset.panel === key);
      });
    });
  });

  // Chips ausw√§hlbar machen
  document.querySelectorAll('.hw-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      const input = chip.querySelector('input');
      if (input) {
        // bei checkbox toggle
        if (input.type === 'checkbox') {
          input.checked = !input.checked;
          chip.classList.toggle('is-selected', input.checked);
        }
        // bei radio nur diesen markieren
        if (input.type === 'radio') {
          const name = input.name;
          document.querySelectorAll('input[name="'+name+'"]').forEach(r => {
            const parent = r.closest('.hw-chip');
            if (parent) parent.classList.remove('is-selected');
          });
          input.checked = true;
          chip.classList.add('is-selected');
        }
      }
    });
  });

  // Reset
  const resetBtn = document.getElementById('hw-filter-reset');
  if (resetBtn){
    resetBtn.addEventListener('click', () => {
      // inputs leeren
      document.querySelectorAll('.hw-panel input').forEach(i => {
        if (i.type === 'checkbox' || i.type === 'radio') {
          i.checked = false;
          const p = i.closest('.hw-chip');
          if (p) p.classList.remove('is-selected');
        } else {
          i.value = '';
        }
      });
      // aktive chips oben leeren
      const af = document.getElementById('hw-active-filters');
      if (af) af.innerHTML = '';
    });
  }

  // Anwenden-Buttons ‚Üí nur UI anzeigen
  document.querySelectorAll('.hw-apply').forEach(btn => {
    btn.addEventListener('click', () => {
      const box = document.getElementById('hw-active-filters');
      if (!box) return;

      // mini-demo: wir sammeln einfach die selektierten chips
      const selectedChips = document.querySelectorAll('.hw-chip.is-selected');
      box.innerHTML = '';
      selectedChips.forEach(ch => {
        const txt = ch.innerText.trim();
        const pill = document.createElement('span');
        pill.className = 'hw-active-pill';
        pill.textContent = txt;
        box.appendChild(pill);
      });

      // Preis
      const min = document.getElementById('hw-price-min').value;
      const max = document.getElementById('hw-price-max').value;
      if (min || max){
        const pill = document.createElement('span');
        pill.className = 'hw-active-pill';
        pill.textContent = `Preis: ${min || '0'} - ${max || '‚àû'}`;
        box.appendChild(pill);
      }

      // hier k√∂nntest du sp√§ter noch echte Query-Parameter bauen
      // und window.location = '/collections/all?...' machen
    });
  });

});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  function getSelected(name){
    return Array.from(document.querySelectorAll('.hw-panel input[name="'+name+'"]:checked'))
      .map(i=>i.value.trim().toLowerCase());
  }
  function getPrice(name){
    const el = document.querySelector('.hw-panel input[name="'+name+'"]');
    if(!el || !el.value) return null;
    const n = parseFloat(el.value.replace(',', '.'));
    return isNaN(n) ? null : Math.round(n * 100); // in Cent
  }
  function applyFilters(){
    const minC = getPrice('min_price');
    const maxC = getPrice('max_price');
    const brands = getSelected('brand');  // ["ferrari", ...]
    const colors = getSelected('color');  // ["blau", ...]
    const rarityEl = document.querySelector('.hw-panel input[name="rarity"]:checked');
    const rarity = rarityEl ? rarityEl.value.trim().toLowerCase() : '';

    const cards = document.querySelectorAll('.hw-product-card, .product-card, .product-item');
    let visible = 0;

    cards.forEach(card=>{
      const title = (card.dataset.title || card.textContent || '').toLowerCase();
      const priceC = parseInt(card.dataset.price || '0', 10);
      const tags = (card.dataset.tags || '').toLowerCase();

      // Preis
      if (minC !== null && priceC < minC) { card.style.display='none'; return; }
      if (maxC !== null && priceC > maxC) { card.style.display='none'; return; }

      // Marke (Titel-Match)
      if (brands.length && !brands.some(b => title.includes(b))) { card.style.display='none'; return; }

      // Farbe (Titel-Match ‚Äì ggf. sp√§ter auf Tags umstellen)
      if (colors.length && !colors.some(c => title.includes(c))) { card.style.display='none'; return; }

      // Seltenheit aus Titel "(TH)" "(STH)"
      if (rarity){
        const hasTH  = title.includes('(th)');
        const hasSTH = title.includes('(sth)');
        if (rarity === 'th'  && !hasTH)  { card.style.display='none'; return; }
        if (rarity === 'sth' && !hasSTH) { card.style.display='none'; return; }
      }

      card.style.display='';
      visible++;
    });

    // Optionale "keine Treffer"-Info
    let info = document.getElementById('hw-filter-result-info');
    if (!info){
      info = document.createElement('div');
      info.id = 'hw-filter-result-info';
      info.style.margin = '8px 0 12px';
      info.style.fontWeight = '700';
      const container = document.querySelector('.hw-filter-box') || document.querySelector('main') || document.body;
      container.appendChild(info);
    }
    info.textContent = visible > 0 ? '' : 'Keine passenden Produkte gefunden.';
  }

  // Anwenden-Kn√∂pfe
  document.querySelectorAll('.hw-filter-apply').forEach(btn=>{
    btn.addEventListener('click', applyFilters);
  });
  // Sofort-Anwenden bei √Ñnderung
  document.querySelectorAll('.hw-panel input').forEach(inp=>{
    inp.addEventListener('change', applyFilters);
  });
  // Reset
  const reset = document.querySelector('[data-filter-reset]');
  if (reset){
    reset.addEventListener('click', ()=>{
      document.querySelectorAll('.hw-panel input[type="checkbox"], .hw-panel input[type="radio"]').forEach(i=> i.checked=false);
      document.querySelectorAll('.hw-panel input[name="min_price"], .hw-panel input[name="max_price"]').forEach(i=> i.value='');
      document.querySelectorAll('.hw-product-card, .product-card, .product-item').forEach(c=> c.style.display='');
      const info = document.getElementById('hw-filter-result-info'); if (info) info.textContent = '';
    });
  }
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  try {
    // ===== Tabs =====
    const tabs = document.querySelectorAll('.hw-tab');
    const panels = document.querySelectorAll('.hw-panel');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const key = tab.dataset.panelTarget;
        tabs.forEach(t => t.classList.remove('is-active'));
        tab.classList.add('is-active');
        panels.forEach(p => p.classList.toggle('is-open', p.dataset.panel === key));
      });
    });

    // ===== Chips (nur Optik √ºber Klasse, Status macht der Browser) =====
    const syncChip = (inp) => {
      const chip = inp.closest('.hw-chip');
      if (!chip) return;
      if (inp.type === 'radio') {
        document.querySelectorAll('input[name="'+inp.name+'"]').forEach(r => {
          const c = r.closest('.hw-chip');
          if (c) c.classList.toggle('is-checked', r.checked);
        });
      } else {
        chip.classList.toggle('is-checked', inp.checked);
      }
    };
    document.querySelectorAll('.hw-chip > input').forEach(inp => {
      syncChip(inp); // initial
      inp.addEventListener('change', () => syncChip(inp));
    });

    // ===== Filter anwenden (Live) =====
    const getChecked = (name) =>
      Array.from(document.querySelectorAll('.hw-panel input[name="'+name+'"]:checked'))
        .map(i => i.value.trim().toLowerCase());

    const getPriceVal = (name) => {
      const el = document.querySelector('.hw-panel input[name="'+name+'"]');
      if (!el || !el.value) return null;
      const n = parseFloat(el.value.replace(',', '.'));
      return isNaN(n) ? null : Math.round(n * 100);
    };

    const applyFilters = () => {
      const minC = getPriceVal('min_price');
      const maxC = getPriceVal('max_price');
      const brands = getChecked('brand');
      const colors = getChecked('color');
      const rarityEl = document.querySelector('.hw-panel input[name="rarity"]:checked');
      const rarity = rarityEl ? rarityEl.value.trim().toLowerCase() : '';

      const cards = document.querySelectorAll('.hw-product-card, .product-card, .product-item');
      let visible = 0;

      cards.forEach(card => {
        const title = (card.dataset.title || card.textContent || '').toLowerCase();
        const tags  = (card.dataset.tags || '').toLowerCase();
        const price = parseInt(card.dataset.price || '0', 10);

        // Preis
        if (minC !== null && price < minC) { card.style.display='none'; return; }
        if (maxC !== null && price > maxC) { card.style.display='none'; return; }

        // Marke
        if (brands.length && !brands.some(b => title.includes(b) || tags.includes(b))) { card.style.display='none'; return; }

        // Farbe
        if (colors.length && !colors.some(c => title.includes(c) || tags.includes(c))) { card.style.display='none'; return; }

        // Seltenheit aus Titel
        if (rarity) {
          const hasTH  = title.includes('(th)');
          const hasSTH = title.includes('(sth)');
          if (rarity === 'th'  && !hasTH)  { card.style.display='none'; return; }
          if (rarity === 'sth' && !hasSTH) { card.style.display='none'; return; }
        }

        card.style.display = '';
        visible++;
      });

      let info = document.getElementById('hw-filter-result-info');
      if (!info) {
        info = document.createElement('div');
        info.id = 'hw-filter-result-info';
        info.style.margin = '8px 0 12px';
        info.style.fontWeight = '700';
        (document.querySelector('.hw-filter-box') || document.querySelector('main') || document.body).appendChild(info);
      }
      info.textContent = visible > 0 ? '' : 'Keine passenden Produkte gefunden.';
    };

    // Events
    document.querySelectorAll('[data-filter-apply]').forEach(b => b.addEventListener('click', applyFilters));
    document.querySelectorAll('.hw-panel input').forEach(i => i.addEventListener('change', applyFilters));
    const resetBtn = document.querySelector('[data-filter-reset]');
    if (resetBtn) resetBtn.addEventListener('click', () => {
      document.querySelectorAll('.hw-panel input[type="checkbox"], .hw-panel input[type="radio"]').forEach(i => i.checked=false);
      document.querySelectorAll('.hw-panel input[name="min_price"], .hw-panel input[name="max_price"]').forEach(i => i.value='');
      document.querySelectorAll('.hw-product-card, .product-card, .product-item').forEach(c => c.style.display='');
      const info = document.getElementById('hw-filter-result-info'); if (info) info.textContent = '';
      // Chips-Optik nach Reset synchronisieren
      document.querySelectorAll('.hw-chip > input').forEach(inp => syncChip(inp));
    });

    // Optional: beim Laden einmal anwenden
    // applyFilters();
  } catch (e) {
    console.error('HW Filters error:', e);
  }
});
</script>

  </body>
</html>

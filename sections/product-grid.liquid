{% comment %}
  Produkt-Grids für Collection-Seite
  - Nutzt das aktuelle Collection-Objekt
  - Saubere Cards, responsive Grid
{% endcomment %}

<section class="hw-collection">
  {% if collection.title %}
    <h1 class="hw-collection__title">
      {{ collection.title }}
    </h1>
  {% endif %}

  {% if collection.description != blank %}
    <div class="hw-collection__desc">
      {{ collection.description }}
    </div>
  {% endif %}

  {% if collection.products_count == 0 %}
    <p class="hw-collection__empty">
      Aktuell sind hier keine Produkte verfügbar.
    </p>
  {% else %}
    <div class="hw-grid">
      {% for product in collection.products %}

      {%- assign hw_color = '' -%}
{%- assign hw_brand = '' -%}
{%- assign hw_rare  = '' -%}

{%- for t in product.tags -%}
  {%- assign t_down = t | downcase -%}

  {%- comment -%}
    FARBE erkennen: egal ob "Farbe: Rot" oder nur "Rot" o.ä.
  {%- endcomment -%}
  {%- if t_down contains 'rot' -%}
    {%- assign hw_color = 'Rot' -%}
  {%- elsif t_down contains 'blau' -%}
    {%- assign hw_color = 'Blau' -%}
  {%- elsif t_down contains 'orange' -%}
    {%- assign hw_color = 'Orange' -%}
  {%- elsif t_down contains 'gelb' -%}
    {%- assign hw_color = 'Gelb' -%}
  {%- elsif t_down contains 'grün' or t_down contains 'gruen' -%}
    {%- assign hw_color = 'Grün' -%}
  {%- elsif t_down contains 'schwarz' -%}
    {%- assign hw_color = 'Schwarz' -%}
  {%- elsif t_down contains 'weiß' or t_down contains 'weiss' -%}
    {%- assign hw_color = 'Weiß' -%}
  {%- elsif t_down contains 'grau' -%}
    {%- assign hw_color = 'Grau' -%}
  {%- endif -%}

  {%- comment -%}
    MARKE erkennen: z.B. "Marke: Porsche" oder "Porsche" als Tag
  {%- endcomment -%}
  {%- if t_down contains 'porsche' -%}
    {%- assign hw_brand = 'Porsche' -%}
  {%- elsif t_down contains 'ferrari' -%}
    {%- assign hw_brand = 'Ferrari' -%}
  {%- elsif t_down contains 'bmw' -%}
    {%- assign hw_brand = 'BMW' -%}
  {%- elsif t_down contains 'mercedes' -%}
    {%- assign hw_brand = 'Mercedes' -%}
  {%- elsif t_down contains 'lamborghini' -%}
    {%- assign hw_brand = 'Lamborghini' -%}
  {%- elsif t_down contains 'toyota' -%}
    {%- assign hw_brand = 'Toyota' -%}
  {%- elsif t_down contains 'nissan' -%}
    {%- assign hw_brand = 'Nissan' -%}
  {%- elsif t_down contains 'audi' -%}
    {%- assign hw_brand = 'Audi' -%}
  {%- elsif t_down contains 'mclaren' -%}
    {%- assign hw_brand = 'McLaren' -%}
  {%- elsif t_down contains 'koenigsegg' or t_down contains 'koenigsegg' -%}
    {%- assign hw_brand = 'Koenigsegg' -%}
  {%- endif -%}

  {%- comment -%}
    SELTENHEIT erkennen: TH / STH / Mainline
  {%- endcomment -%}
  {%- if t_down contains 'sth' -%}
    {%- assign hw_rare = 'STH' -%}
  {%- elsif t_down contains ' th' or t_down startswith 'th' -%}
    {%- assign hw_rare = 'TH' -%}
  {%- elsif t_down contains 'mainline' -%}
    {%- assign hw_rare = 'Mainline' -%}
  {%- endif -%}
{%- endfor -%}

{%- assign hw_price_cents = product.price | divided_by: 1 -%}

        <article
          class="product-card"
          data-color="{{ hw_color }}"
          data-brand="{{ hw_brand }}"
          data-rare="{{ hw_rare }}"
          data-price="{{ hw_price_cents }}"
        >
          <a href="{{ product.url }}" class="hw-card__link">
            <div class="hw-card__image-wrap">
              {% if product.featured_image %}
                <img
                  src="{{ product.featured_image | img_url: '540x540' }}"
                  alt="{{ product.featured_image.alt | escape }}"
                  loading="lazy"
                  class="hw-card__image"
                >
              {% endif %}

              {%- if product.compare_at_price_max > product.price -%}
                <div class="hw-card__badge hw-card__badge--sale">
                  Sale
                </div>
              {%- endif -%}
            </div>

            <div class="hw-card__body">
              <h2 class="hw-card__title">
                {{ product.title }}
              </h2>

              <div class="hw-card__prices">
                {% if product.compare_at_price_max > product.price %}
                  <span class="hw-card__price--old">
                    {{ product.compare_at_price_max | money }}
                  </span>
                {% endif %}
                <span class="hw-card__price">
                  {{ product.price | money }}
                </span>
              </div>
            </div>
          </a>

          <form method="post" action="/cart/add" class="hw-card__form" enctype="multipart/form-data">
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
            <button type="submit" class="hw-card__btn">
              In den Warenkorb
            </button>
          </form>
        </article>
      {% endfor %}
    </div>
  {% endif %}
</section>

{% schema %}
{
  "name": "Produktgrid",
  "settings": []
}
{% endschema %}

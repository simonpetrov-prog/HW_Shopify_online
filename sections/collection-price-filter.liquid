{%- assign current_min = request.params.min_price -%}
{%- assign current_max = request.params.max_price -%}
{%- assign current_sort = request.params.sort_by | default: collection.sort_by -%}
{%- assign has_active = current_min or current_max -%}

<details class="pricebar" {% if has_active %}open{% endif %}>
  <summary class="pricebar__toggle">
    Preisfilter
    {% if has_active %}
      – aktiv: {% if current_min %}ab {{ current_min | replace: '.', ',' }}€{% endif %}
      {% if current_min and current_max %} bis {% endif %}
      {% if current_max %}{{ current_max | replace: '.', ',' }}€{% endif %}
    {% endif %}
  </summary>

  <form class="pricebar__form" method="get" action="{{ collection.url }}">
    <label class="switch">
      <input id="price_enable" type="checkbox" {% if has_active %}checked{% endif %}>
      <span>Preisfilter aktivieren</span>
    </label>

    <div class="pricebar__group">
      <label for="min_price">von (€)</label>
      <input id="min_price" name="min_price" type="number" step="0.01" min="0" inputmode="decimal"
             placeholder="z. B. 3" value="{{ current_min }}" {% unless has_active %}disabled{% endunless %}>
    </div>

    <div class="pricebar__group">
      <label for="max_price">bis (€)</label>
      <input id="max_price" name="max_price" type="number" step="0.01" min="0" inputmode="decimal"
             placeholder="z. B. 20" value="{{ current_max }}" {% unless has_active %}disabled{% endunless %}>
    </div>

    {% if current_sort %}
      <input type="hidden" name="sort_by" value="{{ current_sort }}">
    {% endif %}

    <button class="btn" type="submit" {% unless has_active %}disabled{% endunless %}>Filter anwenden</button>
    {% if has_active %}
      <a class="btn-outline" href="{{ collection.url }}{% if current_sort %}?sort_by={{ current_sort }}{% endif %}">Zurücksetzen</a>
    {% endif %}
  </form>
</details>

<script>
  document.addEventListener('DOMContentLoaded', function(){
    const enable = document.getElementById('price_enable');
    const minI = document.getElementById('min_price');
    const maxI = document.getElementById('max_price');
    const btn  = document.querySelector('.pricebar .btn');

    if (!enable || !minI || !maxI || !btn) return;

    function sync(){
      const on = enable.checked;
      minI.disabled = maxI.disabled = btn.disabled = !on;
      if (!on){ minI.value = ''; maxI.value=''; }
    }
    enable.addEventListener('change', sync);
  });
</script>

<style>
.pricebar{ margin:10px 0 18px; border:1px solid var(--border); border-radius:10px; background:#fff; }
.pricebar__toggle{ cursor:pointer; font-weight:600; padding:10px 12px; display:block; }
.pricebar[open] .pricebar__toggle{ border-bottom:1px solid var(--border); }
.pricebar__form{ display:flex; gap:12px; align-items:flex-end; flex-wrap:wrap; padding:12px; }
.pricebar__group{ display:flex; flex-direction:column; gap:6px; }
.pricebar input[type="number"]{ border:1px solid var(--border); border-radius:8px; padding:8px 10px; background:#fff; width:130px; }
.switch{ display:flex; align-items:center; gap:8px; margin-right:8px; }
</style>

{% schema %}{ "name":"Preisfilter (aktiv bei Toggle)", "settings":[] }{% endschema %}

{% comment %}
  HW Central Seller – Header (Logo • Menü • Suche • Warenkorb)
  Section: sections/header.liquid
{% endcomment %}

{%- comment -%} HW MOBILE HEADER + DRAWER {%- endcomment -%}

<!-- Mobile Header (nur ≤768px sichtbar) -->
<header class="hw-m-header" role="banner" aria-label="Mobile Header">
  <div class="hw-m-header__inner">
    <!-- Logo (links) -->
    <a class="hw-m-logo" href="/" aria-label="Startseite">
      {% if settings.logo != blank %}
        <img src="{{ settings.logo | image_url: width: 240 }}" alt="{{ shop.name | escape }}">
      {% else %}
        <span class="hw-m-logo__text">{{ shop.name }}</span>
      {% endif %}
    </a>

    <!-- Suche (mitte) -->
    <form class="hw-m-search" action="/search" method="get" role="search" aria-label="Shop-Suche">
      <input class="hw-m-search__input" type="search" name="q" placeholder="Suche…" autocomplete="off">
      <button class="hw-m-search__btn" type="submit" aria-label="Suchen">Suchen</button>
    </form>

    <!-- Hamburger (rechts) -->
    <button class="hw-m-burger" type="button" aria-label="Menü öffnen" aria-controls="hw-mobile-drawer" aria-expanded="false" data-hw-mopen>
      <span class="hw-m-burger__bar"></span>
      <span class="hw-m-burger__bar"></span>
      <span class="hw-m-burger__bar"></span>
    </button>
  </div>
</header>

<!-- Mobile Drawer -->
<aside id="hw-mobile-drawer" class="hw-m-drawer" aria-hidden="true">
  <div class="hw-m-drawer__head">
    <strong>Menü</strong>
    <button class="hw-m-close" type="button" aria-label="Menü schließen" data-hw-mclose>×</button>
  </div>

  <nav class="hw-m-nav" aria-label="Mobile Navigation">
    <a class="hw-m-link" href="/">Startseite</a>
    <a class="hw-m-link" href="/collections/all">Produkte</a>
    <a class="hw-m-link hw-m-cartlink" href="{{ routes.cart_url }}">
      Warenkorb
      <span class="hw-m-badge" data-cart-count {% unless cart.item_count > 0 %}hidden{% endunless %}>
        {{ cart.item_count }}
      </span>
    </a>
  </nav>
</aside>

<!-- Overlay -->
<div class="hw-m-overlay" data-hw-mclose aria-hidden="true"></div>

<style>
/* Sichtbarkeit: nur Mobile */
@media (max-width: 768px){
  .hw-m-header{display:block;}
  .header, .site-header, .header-desktop{display:none !important;} /* alten Desktop-Header auf Mobile ausblenden */
}
@media (min-width: 769px){
  .hw-m-header, #hw-mobile-drawer, .hw-m-overlay{display:none !important;}
}

/* Mobile Header */
.hw-m-header{
  position:sticky; top:0; z-index:60;
  background:#fff; border-bottom:1px solid var(--border, #e5e5e5);
}
.hw-m-header__inner{
  display:grid; grid-template-columns: 1fr auto auto; /* Logo | Suche | Burger */
  align-items:center; gap:8px; padding:8px 10px;
}
.hw-m-logo img{height:32px; width:auto; display:block;}
.hw-m-logo__text{font-weight:900; font-size:16px; color:#111}

/* Suche kompakt */
.hw-m-search{ display:flex; align-items:center; gap:6px; justify-self:center; min-width: 40vw; }
.hw-m-search__input{
  border:1px solid #ddd; border-radius:999px; padding:6px 10px; font-size:14px; width: 100%;
}
.hw-m-search__btn{
  border:0; border-radius:999px; padding:6px 10px; font-weight:800; cursor:pointer;
  background: var(--primary, #0046BE); color:#fff;
}
.hw-m-search__btn:hover{ filter:brightness(.95); }

/* Burger */
.hw-m-burger{
  width:40px; height:36px; border:0; background:transparent; display:grid; gap:4px; align-content:center; justify-items:center; cursor:pointer;
}
.hw-m-burger__bar{
  width:22px; height:2px; background:#111; border-radius:2px; display:block;
}

/* Drawer (rechts) */
.hw-m-drawer{
  position:fixed; top:0; right:-320px; width:320px; max-width:92vw; height:100%;
  background:#fff; box-shadow:-10px 0 24px rgba(0,0,0,.14);
  z-index:70; transition:right .25s ease;
  display:flex; flex-direction:column;
}
.hw-m-drawer.open{ right:0; }
.hw-m-drawer__head{
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  padding:14px 16px; background:var(--primary, #0046BE); color:#fff;
}
.hw-m-close{ background:#fff; border:0; border-radius:8px; padding:4px 10px; font-weight:900; cursor:pointer; }

/* Drawer Nav */
.hw-m-nav{ padding:12px 10px; display:flex; flex-direction:column; gap:8px; }
.hw-m-link{
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 12px; border:1px solid #eee; border-radius:12px; font-weight:800; color:#111; text-decoration:none;
}
.hw-m-link:hover{ border-color: var(--accent, #FF6B00); color: var(--accent, #FF6B00); }
.hw-m-cartlink{ position:relative; }
.hw-m-badge{
  min-width:22px; height:22px; padding:0 6px; border-radius:999px; background:#000; color:#fff; font-size:12px; display:inline-flex; align-items:center; justify-content:center;
}

/* Overlay */
.hw-m-overlay{
  position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:65; opacity:0; visibility:hidden; transition:opacity .2s ease, visibility .2s;
}
.hw-m-overlay.show{ opacity:1; visibility:visible; }

/* Body Lock */
html.menu-open, body.menu-open{ overflow:hidden; }
</style>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const drawer = document.getElementById('hw-mobile-drawer');
  const openBtn = document.querySelector('[data-hw-mopen]');
  const closeEls = document.querySelectorAll('[data-hw-mclose], .hw-m-overlay');
  const overlay = document.querySelector('.hw-m-overlay');

  function openMenu(){
    drawer.classList.add('open');
    overlay.classList.add('show');
    document.documentElement.classList.add('menu-open');
    document.body.classList.add('menu-open');
    openBtn?.setAttribute('aria-expanded','true');
    drawer?.setAttribute('aria-hidden','false');
  }
  function closeMenu(){
    drawer.classList.remove('open');
    overlay.classList.remove('show');
    document.documentElement.classList.remove('menu-open');
    document.body.classList.remove('menu-open');
    openBtn?.setAttribute('aria-expanded','false');
    drawer?.setAttribute('aria-hidden','true');
  }

  openBtn?.addEventListener('click', openMenu);
  closeEls.forEach(el=> el.addEventListener('click', closeMenu));
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeMenu(); });

  // Cart-Badge aktuell halten (falls dein Cart-Event schon existiert)
  document.addEventListener('hw:cart-updated', (ev)=>{
    const count = ev?.detail?.item_count ?? null;
    const badge = document.querySelector('[data-cart-count]');
    if (!badge) return;
    if (typeof count === 'number'){
      badge.textContent = count;
      if (count > 0) badge.removeAttribute('hidden'); else badge.setAttribute('hidden','hidden');
    }
  });
});
</script>

<header class="header" role="banner">
  <div class="header__inner">

    {%- comment -%} Logo {%- endcomment -%}
    <a class="header__logo" href="{{ routes.root_url }}" aria-label="{{ shop.name }}">
      {% if section.settings.logo != blank %}
        <img
          src="{{ section.settings.logo | image_url: width: 300 }}"
          alt="{{ shop.name | escape }}"
          style="height: {{ section.settings.logo_height | default: 36 }}px; width: auto;"
          loading="eager"
        >
      {% else %}
        <span class="header__logo-text">{{ shop.name }}</span>
      {% endif %}
    </a>

    {%- comment -%} Hauptmenü {%- endcomment -%}
    <nav class="header__inline-menu" role="navigation" aria-label="Hauptmenü">
  <ul class="list-menu">
    <!-- Feste Buttons -->
    <li>
      <a href="/"
         class="nav__link {% if template.name == 'index' %}is-active{% endif %}">
        Startseite
      </a>
    </li>
    <li>
      <a href="/collections/all"
         class="nav__link {% if template.name == 'collection' or request.path contains '/collections' %}is-active{% endif %}">
        Produkte
      </a>
    </li>

    <!-- Optional: zusätzlich ausgewähltes Menü anhängen -->
    {% if section.settings.main_menu != blank %}
      {% for link in section.settings.main_menu.links %}
        <li>
          <a class="nav__link{% if link.active %} is-active{% endif %}" href="{{ link.url }}">{{ link.title }}</a>
        </li>
      {% endfor %}
    {% endif %}
  </ul>
</nav>

    {%- comment -%} Suche (zwischen Menü und Warenkorb) {%- endcomment -%}
    <form class="hw-inline-search" action="/collections/all" method="get" ...>
      <input
        class="hw-inline-search__input"
        type="search"
        name="q"
        placeholder="Suche…"
        autocomplete="off"
        aria-label="Suche"
      >
      <button class="hw-inline-search__btn" type="submit" aria-label="Suchen">Suchen</button>
    </form>

    {%- comment -%} Warenkorb-Button (Badge nutzt data-cart-count) {%- endcomment -%}
<button
  type="button"
  class="cart-btn"
  data-cart-toggle
  aria-label="Warenkorb öffnen">
  <span class="cart-btn__text">Warenkorb</span>
  <span class="cart-badge"
        data-cart-count
        {% unless cart.item_count > 0 %}hidden{% endunless %}>
    {{ cart.item_count }}
  </span>
</button>

  </div>
</header>

<style>
/* ===== Header Layout & Basics ===== */
.header{
  position: sticky; top: 0; z-index: 30; background: #fff;
  border-bottom: 1px solid var(--border, #e5e5e5);
  transition: box-shadow .2s ease;
}
.header.is-scrolled{ box-shadow: 0 6px 22px rgba(0,0,0,.06); }

.header__inner{
  max-width: 1200px; margin: 0 auto; padding: 12px 20px;
  display: flex; align-items: center; gap: 16px;
}

/* Logo */
.header__logo{ display:inline-flex; align-items:center; min-width: 0; }
.header__logo img{ display:block; height:auto; }
.header__logo-text{ font-weight: 900; font-size: 18px; color: #111; }

/* Menü */
.header__inline-menu{ flex: 0 1 auto; }
.header__inline-menu .list-menu{
  display:flex; gap: 8px; align-items:center; margin:0; padding:0; list-style:none;
  overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-width:none;
}
.header__inline-menu .list-menu::-webkit-scrollbar{ display:none; }

.nav__link{
  padding:8px 12px; border-radius:10px; font-weight:800; color:#111;
  position:relative; white-space:nowrap; display:inline-block;
}
.nav__link:hover{ background: rgba(0,70,190,.08); color: var(--primary,#0046BE); }
.nav__link.is-active{ color:#fff; background: var(--primary,#0046BE); }
.nav__link.is-active::after{
  content:''; position:absolute; left:0; right:0; margin:auto; bottom:-6px;
  width:24px; height:3px; border-radius:2px; background: var(--accent,#FF6B00);
}

/* Suche (zwischen Menü & Warenkorb) */
.hw-inline-search{
  display:flex; align-items:center; gap:8px;
  background:#f6f7fb; border:1px solid #e5e7eb; border-radius:999px;
  padding:6px 8px; min-width:220px; max-width:360px; flex: 0 1 360px;
}
.hw-inline-search:focus-within{ border-color: var(--primary,#0046BE); box-shadow: 0 0 0 3px rgba(0,70,190,.12); }
.hw-inline-search__input{
  flex:1; border:0; background:transparent; outline:none;
  font-size:14px; color:#111; min-width:120px;
}
.hw-inline-search__input::placeholder{ color:#6b7280; }
.hw-inline-search__btn{
  background: var(--primary,#0046BE); color:#fff; border:0; border-radius:999px;
  padding:8px 12px; font-weight:800; cursor:pointer; transition:.15s;
}
.hw-inline-search__btn:hover{ filter:brightness(.95); }
.hw-inline-search__btn:active{ transform: translateY(1px); }

<!-- Warenkorb-Button -->
<a href="{{ routes.cart_url }}"
   class="cart-btn"
   data-cart-toggle
   aria-controls="cart-drawer"
   aria-expanded="false">
  <span class="cart-btn__text">Warenkorb</span>
  <span class="cart-badge" data-cart-count {% unless cart.item_count > 0 %}hidden{% endunless %}>
    {{ cart.item_count }}
  </span>
</a>

/* Mobile Verhalten */
@media (max-width: 768px){
  .header__inner{ gap: 10px; padding: 10px 12px; }
  .hw-inline-search{
    min-width:0; width:42px; padding:6px; gap:0; overflow:hidden;
    border-radius:12px; transition: width .18s ease, padding .18s ease;
  }
  .hw-inline-search__input{ width:0; opacity:0; transition: opacity .12s; }
  .hw-inline-search.hw--open{ width:min(76vw,420px); padding:6px 8px; gap:8px; }
  .hw-inline-search.hw--open .hw-inline-search__input{ width:auto; opacity:1; }
  .cart-btn{ padding:8px 14px; border-radius:10px; }
  .cart-btn__text{ font-size:14px; }
}

/* Menü-Links: Basis + Unterstrich immer exakt zentriert */
.header__inline-menu .list-menu a.nav__link{
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 8px 12px 10px;     /* etwas Platz unten für die Linie */
  border-radius: 10px;
  font-weight: 800;
  color: #111;
  white-space: nowrap;
}

.header__inline-menu .list-menu a.nav__link:hover{
  background: rgba(0,70,190,.08);
  color: var(--primary,#0046BE);
}

/* Aktiver Zustand + Mini-Leiste perfekt mittig */
.header__inline-menu .list-menu a.nav__link.is-active{
  color: #fff;
  background: var(--primary,#0046BE);
}

.header__inline-menu .list-menu a.nav__link.is-active::after{
  content: "";
  position: absolute;
  left: 0 !important;
  right: 0 !important;
  bottom: -6px;               /* Abstand unter dem Chip */
  margin: 0 auto !important;  /* zentriert */
  width: 24px;                /* kurze, elegante Linie */
  height: 3px;
  border-radius: 2px;
  background: var(--accent,#FF6B00);
  transform: none !important; /* alte translate-Fixes aushebeln */
}

@media (max-width: 768px){
  .hw-inline-search{
    min-width:0;
    width:36px; /* kleiner */
    padding:4px;
    gap:0;
    overflow:hidden;
    border-radius:10px;
    transition: width .18s ease, padding .18s ease;
  }
  .hw-inline-search__btn{
    padding:6px 8px;
    font-size:12px;
  }
  .hw-inline-search.hw--open{
    width:min(72vw, 320px);
    padding:6px 8px;
    gap:6px;
  }
  .hw-inline-search__input{ font-size:13px; }
}

/* --- Desktop Layout justieren --- */
.header__inner{
  max-width: 1200px;
  margin: 0 auto;
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: flex-start; /* Start, damit Logo links bleibt */
  gap: 16px;
}

/* Menü & Suche weiter rechts positionieren */
.header__inline-menu{
  margin-left: auto; /* Menü rückt auf rechte Seite */
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  gap: 16px;
}

.hw-inline-search{
  flex: 0 1 280px;
  margin-left: 10px;
}

</style>

<script>
/* Shadow beim Scrollen */
document.addEventListener('scroll', function(){
  var h = document.querySelector('.header');
  if(!h) return;
  h.classList.toggle('is-scrolled', window.scrollY > 8);
});

/* Mobile: Suchleiste aufklappen */
(function(){
  var form = document.querySelector('.hw-inline-search');
  if(!form) return;
  var input = form.querySelector('.hw-inline-search__input');
  var btn = form.querySelector('.hw-inline-search__btn');

  function isMobile(){ return window.matchMedia('(max-width: 768px)').matches; }
  function open(){ form.classList.add('hw--open'); setTimeout(function(){ input && input.focus(); }, 30); }
  function close(){ form.classList.remove('hw--open'); }

  btn.addEventListener('click', function(e){
    if(isMobile() && !form.classList.contains('hw--open')){
      e.preventDefault(); open();
    }
  });
  input.addEventListener('focus', function(){ if(isMobile()) open(); });
  document.addEventListener('keydown', function(e){ if(e.key==='Escape') close(); });
  document.addEventListener('click', function(e){
    if(isMobile() && !form.contains(e.target)) close();
  });
})();
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    { "type": "image_picker", "id": "logo", "label": "Logo" },
    { "type": "range", "id": "logo_height", "label": "Logo-Höhe", "min": 24, "max": 64, "step": 4, "unit": "px", "default": 36 },
    { "type": "link_list", "id": "main_menu", "label": "Hauptmenü" }
  ]
}
{% endschema %}

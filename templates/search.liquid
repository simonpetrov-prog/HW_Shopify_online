{% comment %}
  Suche = gleiche Optik wie Produktseite

  - Wenn ein Suchbegriff da ist → nur passende Produkte
  - Wenn kein Suchbegriff / Seite frisch geladen → alle Produkte aus der Haupt-Collection
{% endcomment %}

<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <title>Produkte – {{ settings.shop_name | default: shop.name }}</title>
    {{ content_for_header }}
    {{ 'base.css' | asset_url | stylesheet_tag }}
  </head>
  <body>
    {% section 'header' %}

    <main class="container" style="margin:16px auto 32px">
      {%- comment -%} Überschrift immer gleich wie Produktseite {%- endcomment -%}
      <h1 style="margin:0 0 12px;font-weight:900;font-size:26px;">Produkte</h1>

      {%- comment -%}
        Suchleiste oben – dieselbe Logik wie im Header,
        aber zusätzlich direkt auf der Seite.
      {%- endcomment -%}
      <form action="/search" method="get" role="search" style="display:flex;gap:10px;margin:10px 0 18px;">
        <input
          type="search"
          name="q"
          value="{{ search.terms | escape }}"
          placeholder="Suche nach Modellen, Marken…"
          style="flex:1;border:1px solid #ddd;border-radius:999px;padding:10px 14px;"
        >
        <button class="btn btn--primary" type="submit">Suchen</button>
      </form>

      {%- comment -%}
        Wenn eine Suche ausgeführt wurde UND ein Begriff drin ist → nur Treffer
      {%- endcomment -%}
      {% if search.performed and search.terms != blank %}
        {% assign product_results = search.results | where: "object_type", "product" %}

        {% if product_results.size > 0 %}
          <p style="margin:0 0 12px;opacity:.7;">
            {{ product_results.size }} Produkt(e) für „{{ search.terms }}“
          </p>

          <div class="product-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:18px;">
            {% for item in product_results %}
              <a href="{{ item.url }}" class="product-card" style="display:block;border:1px solid #e5e5e5;border-radius:12px;padding:10px;background:#fff;transition:transform .12s ease,box-shadow .12s ease;">
                <div style="border-radius:10px;overflow:hidden;background:#fff;">
                  {% if item.featured_image %}
                    <img
                      src="{{ item.featured_image | image_url: width: 600 }}"
                      alt="{{ item.title | escape }}"
                      style="width:100%;height:180px;object-fit:cover;display:block;"
                    >
                  {% endif %}
                </div>
                <div style="margin-top:8px;font-weight:800;">
                  {{ item.title }}
                </div>
                <div style="margin-top:4px;color:#111;font-weight:800;">
                  {%- if item.compare_at_price > item.price -%}
                    <s style="opacity:.6;margin-right:4px;">{{ item.compare_at_price | money }}</s>
                  {%- endif -%}
                  {{ item.price | money }}
                </div>
              </a>
            {% endfor %}
          </div>

          <h2 style="margin:28px 0 10px;font-size:20px;font-weight:800;">
            Was interessant sein könnte
          </h2>
          <div class="product-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:18px;">
            {% for product in collections['all'].products limit: 4 %}
              <a href="{{ product.url }}" class="product-card" style="display:block;border:1px solid #e5e5e5;border-radius:12px;padding:10px;background:#fff;">
                {% if product.featured_image %}
                  <img
                    src="{{ product.featured_image | image_url: width: 600 }}"
                    alt="{{ product.title | escape }}"
                    style="width:100%;height:160px;object-fit:cover;border-radius:8px;background:#fff;"
                  >
                {% endif %}
                <div style="margin-top:8px;font-weight:800;">{{ product.title }}</div>
                <div style="margin-top:4px;">
                  {{ product.price | money }}
                </div>
              </a>
            {% endfor %}
          </div>

        {% else %}
          <p style="margin-top:10px;">Keine Produkte gefunden für „{{ search.terms }}“.</p>

          <h2 style="margin:24px 0 10px;font-size:20px;font-weight:800;">
            Unsere Produkte
          </h2>
          <div class="product-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:18px;">
            {% for product in collections['all'].products %}
              <a href="{{ product.url }}" class="product-card" style="display:block;border:1px solid #e5e5e5;border-radius:12px;padding:10px;background:#fff;">
                {% if product.featured_image %}
                  <img
                    src="{{ product.featured_image | image_url: width: 600 }}"
                    alt="{{ product.title | escape }}"
                    style="width:100%;height:160px;object-fit:cover;border-radius:8px;background:#fff;"
                  >
                {% endif %}
                <div style="margin-top:8px;font-weight:800;">{{ product.title }}</div>
                <div style="margin-top:4px;">
                  {{ product.price | money }}
                </div>
              </a>
            {% endfor %}
          </div>
        {% endif %}

      {%- else -%}
        {%- comment -%}
          KEINE Suche → zeig einfach wie die normale Produktseite:
          alle Produkte (oder deine Main-Collection).
        {%- endcomment -%}

        <p style="margin:0 0 10px;opacity:.7;">Alle verfügbaren Produkte</p>

        <div class="product-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:18px;">
          {% for product in collections['all'].products %}
            <a href="{{ product.url }}" class="product-card" style="display:block;border:1px solid #e5e5e5;border-radius:12px;padding:10px;background:#fff;">
              {% if product.featured_image %}
                <img
                  src="{{ product.featured_image | image_url: width: 600 }}"
                  alt="{{ product.title | escape }}"
                  style="width:100%;height:160px;object-fit:cover;border-radius:8px;background:#fff;"
                >
              {% endif %}
              <div style="margin-top:8px;font-weight:800;">{{ product.title }}</div>
              <div style="margin-top:4px;">
                {{ product.price | money }}
              </div>
            </a>
          {% endfor %}
        </div>

      {%- endif -%}
    </main>

    {% section 'footer' %}
  </body>
</html>

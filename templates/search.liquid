{% comment %}
Suchseite im Produktlisten-Look:
- Zeigt nur Produkte (object_type == 'product')
- Titel & Treffertext stehen ÜBER dem Grid
- Unten: "Was interessant sein könnte" (Empfehlungen)
{% endcomment %}

{% section 'header' %}

<main class="container" style="margin:16px auto 32px">
  {% if search.performed %}
    <h1 class="search-title" style="margin:0 0 6px; font-size:26px; font-weight:900; color:#0046BE;">
      Suchergebnisse für „{{ search.terms }}“
    </h1>

    {% paginate search.results by 24 %}
      {% assign product_results = search.results | where: 'object_type', 'product' %}

      {% if product_results.size > 0 %}
        <p class="search-meta" style="opacity:.75; margin:0 0 14px;">
          {{ product_results.size }} passende Produkt{{ product_results.size == 1 ? '' : 'e' }}
        </p>

        <div class="product-grid hw-search-grid" style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:18px;">
          {% for item in product_results %}
            {% assign product = item %}
            {% if template contains 'reccard' %}
              {% render 'reccard', product: product %}
            {% else %}
              <a href="{{ product.url }}" class="product-card" style="display:block;border:1px solid #e5e5e5;border-radius:12px;padding:10px;background:#fff">
                {% if product.featured_image %}
                  <img src="{{ product.featured_image | img_url: '540x540' }}" alt="{{ product.title | escape }}" style="width:100%;height:210px;object-fit:cover;border-radius:8px;background:#fff">
                {% endif %}
                <div style="margin-top:8px;font-weight:800">{{ product.title }}</div>
                <div style="color:#111;font-weight:800">
                  {%- if product.compare_at_price_max > product.price -%}
                    <s style="color:#9ca3af">{{ product.compare_at_price_max | money }}</s>
                  {%- endif -%}
                  {{ product.price | money }}
                </div>
              </a>
            {% endif %}
          {% endfor %}
        </div>

        {% if paginate.pages > 1 %}
          <nav class="pagination" style="display:flex;gap:10px;justify-content:center;margin-top:18px;">
            {% if paginate.previous %}
              <a class="btn btn-outline" href="{{ paginate.previous.url }}">Zurück</a>
            {% endif %}
            {% if paginate.next %}
              <a class="btn" href="{{ paginate.next.url }}">Weiter</a>
            {% endif %}
          </nav>
        {% endif %}
      {% else %}
        <p style="margin:10px 0 18px;">Keine passenden Produkte gefunden.</p>
      {% endif %}
    {% endpaginate %}
  {% else %}
    <h1 class="search-title" style="margin:0 0 10px; font-size:26px; font-weight:900; color:#0046BE;">
      Suche
    </h1>
    <form action="/search" method="get" role="search" style="display:flex;gap:10px;max-width:560px">
      <input type="search" name="q" placeholder="Suche nach Modellen, Marken…" style="flex:1;border:1px solid #ddd;border-radius:12px;padding:12px 14px">
      <button class="btn btn--primary" type="submit">Suchen</button>
    </form>
  {% endif %}

  <!-- Empfehlungen -->
  <section aria-labelledby="hw-suggested" style="margin-top:36px;">
    <h2 id="hw-suggested" style="font-size:22px;font-weight:900;margin:0 0 12px;">Was interessant sein könnte</h2>
    <div class="product-grid" style="display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:18px;">
      {%- assign pool = collections['all'].products -%}
      {%- if pool.size == 0 -%}
        {%- assign pool = collections.first.products -%}
      {%- endif -%}
      {%- for p in pool limit: 8 -%}
        {% render 'reccard', product: p %}
      {%- endfor -%}
    </div>
  </section>
</main>

{% section 'cart-drawer' %}
{% section 'footer' %}

<style>
  @media (max-width: 900px){
    .hw-search-grid{ grid-template-columns:repeat(2,minmax(0,1fr)) !important; }
  }
  @media (max-width: 640px){
    .hw-search-grid{ grid-template-columns:1fr !important; }
  }
</style>

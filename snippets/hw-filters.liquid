{%- comment -%}
HW Central Seller – Filterbox
Nutzt die data-Attribute aus product-grid.liquid:
- data-color="{{ hw_color }}"
- data-brand="{{ hw_brand }}"
- data-rare="{{ hw_rare }}"
- data-price="{{ hw_price_cents }}" (in Cent)
{%- endcomment -%}

<div class="hw-filters-box">
  <div class="hw-filters-head">
    <h2>Filter</h2>
    <button type="button" class="hw-filter-reset">Zurücksetzen</button>
  </div>

  <!-- Tabs -->
  <div class="hw-filter-tabs">
    <button type="button" class="hw-filter-tab is-active" data-panel="price">Preis</button>
    <button type="button" class="hw-filter-tab" data-panel="color">Farbe</button>
    <button type="button" class="hw-filter-tab" data-panel="brand">Marke</button>
    <button type="button" class="hw-filter-tab" data-panel="rare">Seltenheit</button>
  </div>

  <!-- Panels -->
  <div class="hw-filter-panels">
    <!-- Preis -->
    <div class="hw-filter-panel" data-panel="price">
      <div class="hw-filter-row">
        <label>
          Min (€)
          <input type="number" id="hw-price-min" min="0" step="0.5" placeholder="z. B. 2">
        </label>
        <label>
          Max (€)
          <input type="number" id="hw-price-max" min="0" step="0.5" placeholder="z. B. 10">
        </label>
      </div>
      <p class="hw-filter-hint">Filtert nach aktuellem Produktpreis.</p>
    </div>

    <!-- Farbe -->
    <div class="hw-filter-panel" data-panel="color" hidden>
      <div class="hw-chip-row">
        {% assign colors = "Rot,Blau,Orange,Schwarz,Weiß,Grau,Grün,Gelb,Lila,Pink" | split: "," %}
        {% for c in colors %}
          <label class="hw-chip">
            <input type="checkbox" value="{{ c }}" data-group="color">
            {{ c }}
          </label>
        {% endfor %}
      </div>
    </div>

    <!-- Marke -->
    <div class="hw-filter-panel" data-panel="brand" hidden>
      <div class="hw-chip-row">
        {% assign brands = "Porsche,Ferrari,BMW,Mercedes,Lamborghini,Toyota,Nissan,Audi,McLaren,Koenigsegg" | split: "," %}
        {% for b in brands %}
          <label class="hw-chip">
            <input type="checkbox" value="{{ b }}" data-group="brand">
            {{ b }}
          </label>
        {% endfor %}
      </div>
    </div>

    <!-- Seltenheit -->
    <div class="hw-filter-panel" data-panel="rare" hidden>
      <div class="hw-chip-row">
        {% assign rares = "Mainline,TH,STH" | split: "," %}
        {% for r in rares %}
          <label class="hw-chip">
            <input type="checkbox" value="{{ r }}" data-group="rare">
            {{ r }}
          </label>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="hw-filter-actions">
    <button type="button" class="hw-filter-apply">Filter anwenden</button>
  </div>
</div>

<style>
.hw-filters-box{
  border:2px solid #0046BE;
  border-radius:16px;
  padding:12px 12px 14px;
  margin:10px 0 18px;
  background:#F7F9FF;
}

/* Kopf */
.hw-filters-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:8px;
}
.hw-filters-head h2{
  margin:0;
  font-size:16px;
  font-weight:800;
}
.hw-filter-reset{
  border:0;
  background:transparent;
  color:#6b7280;
  font-size:13px;
  cursor:pointer;
  text-decoration:underline;
}

/* Tabs */
.hw-filter-tabs{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin-bottom:8px;
}
.hw-filter-tab{
  border-radius:999px;
  border:1px solid #d1d5db;
  padding:5px 12px;
  font-size:13px;
  font-weight:700;
  background:#fff;
  cursor:pointer;
}
.hw-filter-tab.is-active{
  background:#0046BE;
  color:#fff;
  border-color:#0046BE;
}

/* Panel-Container */
.hw-filter-panels{
  border-radius:12px;
  background:#fff;
  padding:10px;
  border:1px solid #e5e7eb;
}
.hw-filter-panel[hidden]{ display:none; }

/* Preis-Row */
.hw-filter-row{
  display:flex;
  gap:10px;
}
.hw-filter-row label{
  flex:1;
  display:flex;
  flex-direction:column;
  font-size:13px;
  gap:4px;
}
.hw-filter-row input{
  border-radius:8px;
  border:1px solid #d1d5db;
  padding:6px 8px;
}

.hw-filter-hint{
  margin:6px 0 0;
  font-size:12px;
  color:#6b7280;
}

/* Chips */
.hw-chip-row{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.hw-chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid #d1d5db;
  background:#f9fafb;
  font-size:13px;
  font-weight:600;
  cursor:pointer;
}
.hw-chip input{ display:none; }
.hw-chip.is-active{
  background:#0046BE;
  border-color:#0046BE;
  color:#fff;
}

/* Actions */
.hw-filter-actions{
  margin-top:10px;
  display:flex;
  justify-content:flex-end;
}
.hw-filter-apply{
  border-radius:999px;
  border:0;
  padding:7px 14px;
  font-size:13px;
  font-weight:800;
  background:#FF6B00;
  color:#fff;
  cursor:pointer;
}
.hw-filter-apply:hover{
  filter:brightness(.95);
}

/* Mobile */
@media (max-width: 640px){
  .hw-filter-row{
    flex-direction:column;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function(){
  // Tabs schalten Panels um
  const tabs   = Array.from(document.querySelectorAll('.hw-filter-tab'));
  const panels = Array.from(document.querySelectorAll('.hw-filter-panel'));

  function showPanel(id){
    panels.forEach(p => {
      p.hidden = p.dataset.panel !== id;
    });
    tabs.forEach(t => {
      t.classList.toggle('is-active', t.dataset.panel === id);
    });
  }

  tabs.forEach(t => {
    t.addEventListener('click', () => showPanel(t.dataset.panel));
  });
  if (tabs.length){ showPanel(tabs[0].dataset.panel); }

  // Alle Produktkarten
  const cards = Array.from(document.querySelectorAll('.product-card'));

  // Hilfsfunktion: Werte aus einem Panel einsammeln (Farbe/Marke/Seltenheit)
  function getPanelValues(panelName){
    const panel = document.querySelector('.hw-filter-panel[data-panel="'+panelName+'"]');
    if (!panel) return [];
    return Array.from(panel.querySelectorAll('input[type="checkbox"]:checked'))
      .map(i => i.value.toLowerCase());
  }

  function applyFilters(){
    const selectedColors = getPanelValues('color');
    const selectedBrands = getPanelValues('brand');
    const selectedRares  = getPanelValues('rare');

    const minInput = document.getElementById('hw-price-min');
    const maxInput = document.getElementById('hw-price-max');
    const min = minInput && minInput.value ? parseFloat(minInput.value.replace(',', '.')) : null;
    const max = maxInput && maxInput.value ? parseFloat(maxInput.value.replace(',', '.')) : null;

    cards.forEach(card => {
      let visible = true;

      const color = (card.dataset.color || '').toLowerCase();
      const brand = (card.dataset.brand || '').toLowerCase();
      const rare  = (card.dataset.rare  || '').toLowerCase();
      const priceCents = card.dataset.price ? parseInt(card.dataset.price, 10) : null;
      const price = priceCents !== null ? priceCents / 100 : null;

      if (selectedColors.length && (!color || !selectedColors.includes(color))) {
        visible = false;
      }
      if (selectedBrands.length && (!brand || !selectedBrands.includes(brand))) {
        visible = false;
      }
      if (selectedRares.length && (!rare || !selectedRares.includes(rare))) {
        visible = false;
      }
      if (price !== null){
        if (min !== null && price < min) visible = false;
        if (max !== null && price > max) visible = false;
      }

      card.style.display = visible ? '' : 'none';
    });
  }

  // Chips: blau/grau + direkt filtern
  const chipLabels = Array.from(document.querySelectorAll('.hw-chip'));
  chipLabels.forEach(label => {
    const input = label.querySelector('input[type="checkbox"]');
    if (!input) return;

    const sync = () => label.classList.toggle('is-active', input.checked);

    label.addEventListener('click', (e) => {
      // verhindern, dass das Label-Default doppelt triggert
      if (e.target.tagName !== 'INPUT') {
        input.checked = !input.checked;
      }
      sync();
      applyFilters();
    });

    sync();
  });

  // Preisfelder: bei Änderung filtern
  const minField = document.getElementById('hw-price-min');
  const maxField = document.getElementById('hw-price-max');

  [minField, maxField].forEach(field => {
    if (!field) return;
    field.addEventListener('change', applyFilters);
    field.addEventListener('blur', applyFilters);
  });

  // Buttons unten
  const applyBtn = document.querySelector('.hw-filter-apply');
  const resetBtn = document.querySelector('.hw-filter-reset');

  if (applyBtn){
    applyBtn.addEventListener('click', function(e){
      e.preventDefault();
      applyFilters();
    });
  }

  if (resetBtn){
    resetBtn.addEventListener('click', function(e){
      e.preventDefault();

      // alle Checkboxen zurücksetzen
      chipLabels.forEach(label => {
        const input = label.querySelector('input[type="checkbox"]');
        if (!input) return;
        input.checked = false;
        label.classList.remove('is-active');
      });

      // Preis zurücksetzen
      if (minField) minField.value = '';
      if (maxField) maxField.value = '';

      // wieder alle Produkte zeigen
      cards.forEach(card => { card.style.display = ''; });
    });
  }
});
</script>
